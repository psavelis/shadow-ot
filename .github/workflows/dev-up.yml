name: Dev Up (Makefile)

on:
  workflow_dispatch:
  pull_request:
    branches: [ main ]

jobs:
  dev-up:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Install kind and kubectl
        uses: helm/kind-action@v1.7.0
        with:
          version: v0.23.0

      - name: Make up
        run: |
          make up

      - name: WebSocket check
        run: |
          make ws-check

      - name: Show IPs
        run: |
          make ip

      - name: Make down
        if: always()
        run: |
          make down
